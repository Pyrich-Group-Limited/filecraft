<section class="content">
  <div class="container-fluid">
    <div class="row align-items-center">
      <!-- Left-hand side: Title -->
      <div class="col-md-6 mb-2">
        <span class="mb-0 page-title">{{'DOCUMENTS_AUDIT_TRAIL' | translate}}</span>
        <app-page-help-text [code]="'DOCUMENTS_AUDIT_TRAIL'"></app-page-help-text>
      </div>
    </div>
    <div class="card">
      <div class="header">
        <mat-accordion>
          <mat-expansion-panel [expanded]="step() === 0">
            <mat-expansion-panel-header>
              <mat-panel-title>
                {{ "FILTER" | translate }}
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="d-flex flex-wrap flex-column flex-sm-row">
              <div class="p-1 flex-item flex-fill">
                <input class="form-control" placeholder="{{'SEARCH_DOCUMENT_BY_NAME' | translate}}" #input>
              </div>
              <div class="p-1 flex-item flex-fill">
                <mat-select class="form-control" placeholder="{{'SELECT_CATEGORY' | translate}}"
                  (selectionChange)="onCategoryChange($event)">
                  <mat-option [value]="">-- {{'NONE' | translate}} --</mat-option>
                  <mat-option *ngFor="let category of allCategories" [value]="category.id">
                    <div class="country-item" [ngStyle]="{'margin-left.px': category.deafLevel* 20}">
                      <div *ngIf="!category.parentId">
                        <b> {{category.name}}</b>
                      </div>
                      <div *ngIf="category.parentId">
                        {{category.name}}
                      </div>
                    </div>
                  </mat-option>
                </mat-select>
              </div>
              <div class="p-1 flex-item flex-fill">
                <mat-select class="form-control" placeholder="{{'SELECT_USER' | translate}}"
                  (selectionChange)="onUserChange($event)">
                  <mat-option [value]="">-- {{'NONE' | translate}} --</mat-option>
                  <mat-option *ngFor="let user of users" [value]="user.id">
                    {{user.firstName}} {{user.lastName}}
                  </mat-option>
                </mat-select>
              </div>
            </div>
          </mat-expansion-panel>
        </mat-accordion>
      </div>
      <div class="body">
        <div class="table-responsive">
          <div class="grid-height-medium">
            <table mat-table [dataSource]="dataSource" class="w-100" matSort matSortActive="createdDate"
              matSortDirection="desc">
              <ng-container matColumnDef="createdDate">
                <th class="table-column-fix-200" mat-header-cell *matHeaderCellDef mat-sort-header> {{'ACTION' |
                  translate}} {{'DATE' | translate}}
                </th>
                <td mat-cell *matCellDef="let document"> {{document?.createdDate | utcToLocalTime:'full'}} </td>
              </ng-container>
              <ng-container matColumnDef="documentName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> {{'NAME' | translate}} </th>
                <td mat-cell *matCellDef="let document">
                  <a class="doc-link" (click)="onDocumentView(document)">{{document.documentName}}</a>
                </td>
              </ng-container>
              <ng-container matColumnDef="categoryName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> {{'CATEGORY_NAME' | translate}} </th>
                <td mat-cell *matCellDef="let document"> {{document.categoryName}} </td>
              </ng-container>
              <ng-container matColumnDef="operationName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> {{'OPERATION' | translate}} </th>
                <td mat-cell *matCellDef="let document"> {{document.operationName.toUpperCase() | translate}} </td>
              </ng-container>
              <ng-container matColumnDef="createdBy">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> {{'BY_WHOM' | translate}} </th>
                <td mat-cell *matCellDef="let document"> {{document?.createdBy}} </td>
              </ng-container>
              <ng-container matColumnDef="permissionUser">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> {{'TO_WHOM_USER' | translate}} </th>
                <td mat-cell *matCellDef="let document"> {{document?.permissionUser}} </td>
              </ng-container>
              <ng-container matColumnDef="permissionRole">
                <th mat-header-cell *matHeaderCellDef mat-sort-header> {{'TO_WHOM_ROLE' | translate}} </th>
                <td mat-cell *matCellDef="let document"> {{document?.permissionRole}} </td>
              </ng-container>
              <ng-container matColumnDef="footer">
                <td mat-footer-cell colspan="7" *matFooterCellDef>
                  <mat-paginator [length]="documentResource.totalCount" [pageSize]="documentResource.pageSize"
                    [pageSizeOptions]="[10, 20, 30]">
                  </mat-paginator>
                </td>
              </ng-container>
              <tr mat-header-row *matHeaderRowDef="displayedColumns;sticky: true"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
              <tr mat-footer-row *matFooterRowDef="footerToDisplayed;sticky: true"></tr>
              <tr *matNoDataRow>
                <td colspan="7">
                  <div class="m-2">
                    <b> {{'NO_DATA_FOUND' | translate}}</b>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="spinner-container" *ngIf="dataSource.loading$ | async">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>
